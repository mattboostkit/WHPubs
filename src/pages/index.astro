---
import Layout from '../layouts/Layout.astro';
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { MapPin, Clock, Phone, Music, ChefHat, Beer, ExternalLink, Star, Utensils, Dog, TreePine, Wheat, CalendarDays, Gift } from 'lucide-react';
import { getPubs, getHomepageData, getDevelopmentKitchen, getReviews, getOffers, getEvents } from '../lib/sanity';
import { HeroCarousel } from '@/components/HeroCarousel';
import { getPubUrl, isExternalUrl } from '@/lib/pub-urls';
import ReviewsSection from '@/components/ReviewsSection.astro';
import OffersSection from '@/components/OffersSection.astro';
import PubCardHover from '@/components/PubCardHover';
import EventsCarousel from '@/components/EventsCarousel';
import PubsCarousel from '@/components/PubsCarousel';
import LiveResBookingWidget from '@/components/LiveResBookingWidget';

// This page always renders the main hub content.

// Fetch data needed for the hub page
const pubs = await getPubs(); // Fetches all pubs
const homepageData = await getHomepageData(); // Fetch homepage content
console.log('Homepage data:', homepageData); // Debug log
let developmentKitchen = null;
try {
  developmentKitchen = await getDevelopmentKitchen(); // Fetch development kitchen data
} catch (error) {
  // Development Kitchen data not available yet
}

// Fetch featured reviews for the homepage
const featuredReviews = await getReviews(null, true); // Get featured general reviews

// Fetch active offers for the homepage
const activeOffers = await getOffers(null, true); // Get active general offers

// Fetch upcoming events for the homepage
const upcomingEvents = await getEvents(); // Get all upcoming events

// All pubs are equal - no featured pubs
const allPubs = pubs;


---

{/* Use homepage title from Sanity if available */}
<Layout title={homepageData?.title || "WH Pubs - Traditional British Pubs"}>
  <main>
    {/* Hero Section with Carousel */}
    <HeroCarousel 
      images={homepageData?.heroImages || (homepageData?.heroImage ? [homepageData.heroImage] : [])}
      heroTitle={homepageData?.heroTitle || 'Traditional British Hospitality in the South East of England'}
      heroSubtitle={homepageData?.heroSubtitle || 'Traditional British Hospitality...'}
      heroButton1Text={homepageData?.heroButton1Text}
      heroButton1Link={homepageData?.heroButton1Link}
      heroButton2Text={homepageData?.heroButton2Text}
      heroButton2Link={homepageData?.heroButton2Link}
      client:load
    />

    {/* Special Offers Section */}
    {activeOffers && activeOffers.length > 0 && (
      <OffersSection offers={activeOffers.slice(0, 6)} />
    )}

    {/* Welcome to WH Pubs Section */}
    <section class="py-20 bg-gradient-to-b from-white to-gray-50">
      <div class="container mx-auto px-4">
        <div class="max-w-6xl mx-auto">
          <div class="text-center mb-12">
            <p class="text-secondary uppercase tracking-widest text-sm font-semibold mb-4">Welcome to WH Pubs</p>
            <h2 class="text-4xl font-bold text-primary mb-6">Step into Timeless Tradition</h2>
          </div>
          
          <div class="grid lg:grid-cols-2 gap-12 items-center mb-12">
            {/* Text Content */}
            <div class="space-y-4">
              <p class="text-lg text-gray-700 leading-relaxed">
                Step into warm, welcoming pubs where crackling fires meet contemporary comfort, 
                sun-drenched gardens host perfect afternoons, and our kitchens serve honest British fare with a modern twist.
              </p>
              <p class="text-lg text-gray-700 leading-relaxed">
                We're a collection of traditional pubs across South East England, each with its own character but united 
                by our commitment to quality local produce, carefully kept ales, and genuine hospitality that makes every visit memorable.
              </p>
              <div class="pt-6">
                <a href="/book-table" class="inline-block">
                  <Button size="lg" variant="default">
                    Book a Table
                  </Button>
                </a>
              </div>
            </div>
            
            {/* Images Grid */}
            <div class="grid grid-cols-2 gap-4">
              <div class="space-y-4">
                <img 
                  src={homepageData?.welcomeImage1?.asset?.url || "/images/pub-interior-cozy.jpg"} 
                  alt={homepageData?.welcomeImage1?.alt || "Cozy pub interior with fireplace"} 
                  class="rounded-lg shadow-lg w-full h-48 object-cover"
                  onerror="this.onerror=null; this.src='/images/pub-fallback.jpg';"
                />
                <img 
                  src={homepageData?.welcomeImage2?.asset?.url || "/images/pub-garden-summer.jpg"} 
                  alt={homepageData?.welcomeImage2?.alt || "Sun-drenched pub garden"} 
                  class="rounded-lg shadow-lg w-full h-64 object-cover"
                  onerror="this.onerror=null; this.src='/images/pub-fallback.jpg';"
                />
              </div>
              <div class="space-y-4 pt-8">
                <img 
                  src={homepageData?.welcomeImage3?.asset?.url || "/images/british-food-plate.jpg"} 
                  alt={homepageData?.welcomeImage3?.alt || "Traditional British cuisine"} 
                  class="rounded-lg shadow-lg w-full h-64 object-cover"
                  onerror="this.onerror=null; this.src='/images/food-fallback.jpg';"
                />
                <img 
                  src={homepageData?.welcomeImage4?.asset?.url || "/images/local-ales-bar.jpg"} 
                  alt={homepageData?.welcomeImage4?.alt || "Selection of local ales at the bar"} 
                  class="rounded-lg shadow-lg w-full h-48 object-cover"
                  onerror="this.onerror=null; this.src='/images/pub-fallback.jpg';"
                />
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    {/* Events Carousel Section */}
    {upcomingEvents && upcomingEvents.length > 0 && (
      <EventsCarousel 
        events={upcomingEvents.slice(0, 9)} 
        client:load 
      />
    )}


    {/* All Pubs Grid Section */}
    <section id="pubs" class="py-20 bg-white">
      <div class="container mx-auto px-4">
        <div class="text-center mb-12">
          <p class="text-secondary uppercase tracking-widest text-sm font-semibold mb-4">Explore</p>
          <h2 class="text-4xl font-bold text-primary mb-6">Our Pubs</h2>
        </div>
        <div class="space-y-6">
          {allPubs.length > 0 ? (
            <>
              {/* First row - 3 pubs */}
              <div class="grid md:grid-cols-3 gap-6 sm:gap-8">
                {allPubs.slice(0, 3).map(pub => (
                  <PubCardHover pub={pub} client:load>
                    <Card key={pub.slug.current} className="border-0 shadow-none mb-6 md:mb-0">
                <CardHeader>
                  <CardTitle className="text-lg">{pub.name}</CardTitle>
                  <div class="flex items-center text-sm text-muted-foreground">
                    <MapPin className="w-3 h-3 mr-1" />
                    <span>{pub.locationName || pub.location}</span>
                  </div>
                </CardHeader>
                <CardContent>
                  <CardDescription className="text-sm mb-4 line-clamp-2">{pub.description}</CardDescription>
                  
                  {/* Amenity badges */}
                  <div class="flex flex-wrap gap-2 mb-4">
                    {(pub.amenities?.some(a => a.toLowerCase().includes('dog')) && (
                      <Badge variant="secondary" className="text-xs flex items-center gap-1 bg-secondary/20 text-primary border border-secondary/40">
                        <Dog className="w-3 h-3" />
                        Dog Friendly
                      </Badge>
                    ))}
                    {(pub.amenities?.some(a => a.toLowerCase().includes('garden')) && (
                      <Badge variant="secondary" className="text-xs flex items-center gap-1 bg-secondary/20 text-primary border border-secondary/40">
                        <TreePine className="w-3 h-3" />
                        Garden
                      </Badge>
                    ))}
                    {(pub.amenities?.some(a => a.toLowerCase().includes('ale')) && (
                      <Badge variant="secondary" className="text-xs flex items-center gap-1 bg-secondary/20 text-primary border border-secondary/40">
                        <Beer className="w-3 h-3" />
                        Local Ales
                      </Badge>
                    ))}
                    {(pub.amenities?.some(a => a.toLowerCase().includes('food') || a.toLowerCase().includes('breakfast')) && (
                      <Badge variant="secondary" className="text-xs flex items-center gap-1 bg-secondary/20 text-primary border border-secondary/40">
                        <Utensils className="w-3 h-3" />
                        Food
                      </Badge>
                    ))}
                  </div>
                  
                  {(() => {
                    const pubUrl = getPubUrl(pub);
                    const isExt = isExternalUrl(pubUrl);
                    return (
                      <div class="grid grid-cols-2 gap-3">
                        <a href={pubUrl} target={isExt ? "_blank" : undefined} rel={isExt ? "noopener noreferrer" : undefined} class="block">
                          <Button variant="default" size="sm" className="w-full">
                            Visit Pub Site
                          </Button>
                        </a>
                        <a href="/book-table" class="block">
                          <Button variant="secondary" size="sm" className="w-full">
                            Book a Table
                          </Button>
                        </a>
                      </div>
                    );
                  })()}
                </CardContent>
                    </Card>
                  </PubCardHover>
                ))}
              </div>
              
              {/* Second row - 2 pubs centered */}
              {allPubs.length > 3 && (
                <div class="grid md:grid-cols-2 gap-6 max-w-4xl mx-auto">
                  {allPubs.slice(3, 5).map(pub => (
                    <PubCardHover pub={pub} client:load>
                      <Card key={pub.slug.current} className="border-0 shadow-none">
                      <CardHeader>
                        <CardTitle className="text-lg">{pub.name}</CardTitle>
                        <div class="flex items-center text-sm text-muted-foreground">
                          <MapPin className="w-3 h-3 mr-1" />
                          <span>{pub.locationName || pub.location}</span>
                        </div>
                      </CardHeader>
                      <CardContent>
                        <CardDescription className="text-sm mb-4 line-clamp-2">{pub.description}</CardDescription>
                        
                        {/* Amenity badges */}
                        <div class="flex flex-wrap gap-2 mb-4">
                          {(pub.amenities?.some(a => a.toLowerCase().includes('dog')) && (
                            <Badge variant="secondary" className="text-xs flex items-center gap-1 bg-secondary/20 text-primary border border-secondary/40">
                              <Dog className="w-3 h-3" />
                              Dog Friendly
                            </Badge>
                          ))}
                          {(pub.amenities?.some(a => a.toLowerCase().includes('garden')) && (
                            <Badge variant="secondary" className="text-xs flex items-center gap-1 bg-secondary/20 text-primary border border-secondary/40">
                              <TreePine className="w-3 h-3" />
                              Garden
                            </Badge>
                          ))}
                          {(pub.amenities?.some(a => a.toLowerCase().includes('ale')) && (
                            <Badge variant="secondary" className="text-xs flex items-center gap-1 bg-secondary/20 text-primary border border-secondary/40">
                              <Beer className="w-3 h-3" />
                              Local Ales
                            </Badge>
                          ))}
                          {(pub.amenities?.some(a => a.toLowerCase().includes('food') || a.toLowerCase().includes('breakfast')) && (
                            <Badge variant="secondary" className="text-xs flex items-center gap-1 bg-secondary/20 text-primary border border-secondary/40">
                              <Utensils className="w-3 h-3" />
                              Food
                            </Badge>
                          ))}
                        </div>
                        
                        {
                          (() => {
                            const pubUrl = getPubUrl(pub);
                            const isExt = isExternalUrl(pubUrl);
                            return (
                              <div class="grid grid-cols-2 gap-3">
                                <a href={pubUrl} target={isExt ? "_blank" : undefined} rel={isExt ? "noopener noreferrer" : undefined} class="block">
                                  <Button variant="default" size="sm" className="w-full">
                                    Visit Pub Site
                                  </Button>
                                </a>
                                <a href="/book-table" class="block">
                                  <Button variant="secondary" size="sm" className="w-full">
                                    Book a Table
                                  </Button>
                                </a>
                              </div>
                            );
                          })()
                        }
                      </CardContent>
                      </Card>
                    </PubCardHover>
                  ))}
                </div>
              )}
            </>
          ) : (
            <p class="text-center text-muted-foreground">
              No pubs found.
            </p>
          )}
        </div>
      </div>
    </section>

    {/* Development Kitchen Section */}
    {developmentKitchen && (
      <section class="relative py-20 bg-gradient-to-r from-primary to-primary/95 text-secondary overflow-hidden border-t-4 border-secondary">
        <div class="absolute inset-0 bg-[url('/images/pattern.svg')] opacity-5"></div>
        <div class="container mx-auto px-4 relative z-10">
          <div class="grid md:grid-cols-2 gap-12 items-center">
            <div>
              <Badge variant="secondary" className="mb-4">Innovation Hub</Badge>
              <h2 class="text-4xl font-bold mb-6 text-secondary">{developmentKitchen.title}</h2>
              <p class="text-lg text-secondary/90 mb-8">
                Where culinary innovation meets tradition. Our Development Kitchen is the creative heart of WH Pubs, 
                crafting seasonal menus that celebrate the finest local ingredients.
              </p>
              <div class="grid grid-cols-2 gap-6 mb-8">
                <div>
                  <h3 class="text-xl font-bold mb-2 text-secondary flex items-center">
                    <Utensils className="w-5 h-5 mr-2" />
                    Menu Innovation
                  </h3>
                  <p class="text-secondary/80 text-sm">Creating seasonal dishes that delight</p>
                </div>
                <div>
                  <h3 class="text-xl font-bold mb-2 text-secondary flex items-center">
                    <MapPin className="w-5 h-5 mr-2" />
                    Local Sourcing
                  </h3>
                  <p class="text-secondary/80 text-sm">Supporting regional producers</p>
                </div>
              </div>
              <a href="/development-kitchen">
                <Button size="lg" variant="secondary">
                  Explore Our Kitchen
                </Button>
              </a>
            </div>
            <div class="relative">
              {developmentKitchen.heroImage && (
                <img
                  src={developmentKitchen.heroImage.asset.url}
                  alt={developmentKitchen.heroImage.alt}
                  class="rounded-lg shadow-2xl w-full"
                />
              )}
            </div>
          </div>
        </div>
      </section>
    )}

    {/* Hire Your Own WH Pub Section */}
    <section class="py-20 bg-gradient-to-b from-white to-gray-50">
      <div class="container mx-auto px-4">
        <div class="max-w-6xl mx-auto">
          <div class="text-center mb-12">
            <p class="text-secondary uppercase tracking-widest text-sm font-semibold mb-4">Private Events</p>
            <h2 class="text-4xl font-bold text-primary mb-6">Hire Your Own WH Pub</h2>
          </div>
          
          <div class="grid lg:grid-cols-2 gap-12 items-center">
            {/* Image */}
            <div class="relative rounded-lg overflow-hidden shadow-2xl">
              <img 
                src={homepageData?.pubHireImage?.asset?.url || "/images/pub-hire-event.jpg"} 
                alt={homepageData?.pubHireImage?.alt || "Private pub hire for events"} 
                class="w-full h-full object-cover"
                onerror="this.onerror=null; this.src='/images/pub-interior-cozy.jpg';"
              />
            </div>
            
            {/* Content */}
            <div class="space-y-6">
              <div class="flex items-start gap-4">
                <div class="w-12 h-12 bg-secondary/20 rounded-full flex items-center justify-center flex-shrink-0">
                  <CalendarDays class="w-6 h-6 text-secondary" />
                </div>
                <div>
                  <h3 class="text-xl font-bold text-primary mb-2">A pub for any occasion</h3>
                  <p class="text-gray-700">From intimate gatherings to grand celebrations, we have the perfect space for your event.</p>
                </div>
              </div>
              
              <div class="flex items-start gap-4">
                <div class="w-12 h-12 bg-secondary/20 rounded-full flex items-center justify-center flex-shrink-0">
                  <MapPin class="w-6 h-6 text-secondary" />
                </div>
                <div>
                  <h3 class="text-xl font-bold text-primary mb-2">We bring the pub to you</h3>
                  <p class="text-gray-700">Our mobile pub service delivers authentic British pub experience to your chosen location.</p>
                </div>
              </div>
              
              <div class="flex items-start gap-4">
                <div class="w-12 h-12 bg-secondary/20 rounded-full flex items-center justify-center flex-shrink-0">
                  <Beer class="w-6 h-6 text-secondary" />
                </div>
                <div>
                  <h3 class="text-xl font-bold text-primary mb-2">Just the pub or add a bar</h3>
                  <p class="text-gray-700">Choose from venue hire only or let us provide full bar service with our expert staff.</p>
                </div>
              </div>
              
              <div class="flex items-start gap-4">
                <div class="w-12 h-12 bg-secondary/20 rounded-full flex items-center justify-center flex-shrink-0">
                  <Star class="w-6 h-6 text-secondary" />
                </div>
                <div>
                  <h3 class="text-xl font-bold text-primary mb-2">We can sort out the perfect package for you</h3>
                  <p class="text-gray-700">Our experienced team will work with you to create a bespoke package tailored to your needs.</p>
                </div>
              </div>
              
              <div class="pt-6">
                <a href="https://thegreatbritishpub.co.uk/" target="_blank" rel="noopener noreferrer">
                  <Button size="lg" variant="default">
                    Click for more details
                  </Button>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    {/* What Makes Us Special Section - Full Width */}
    <section class="bg-white">
      <div class="text-center py-16">
        <p class="text-secondary uppercase tracking-widest text-sm font-semibold mb-4">Why Choose Us</p>
        <h2 class="text-4xl font-bold text-primary mb-2">What Makes Us Special</h2>
      </div>
      
      {/* Full-width feature blocks */}
      <div class="w-full">
        {/* Seasonal Menus */}
        <div class="relative h-96 flex items-center justify-center overflow-hidden">
          {homepageData?.specialFeatures?.seasonalMenus?.image ? (
            <div class="absolute inset-0">
              <img 
                src={homepageData.specialFeatures.seasonalMenus.image.asset.url} 
                alt={homepageData.specialFeatures.seasonalMenus.image.alt}
                class="w-full h-full object-cover"
              />
              <div class="absolute inset-0 bg-black/50"></div>
            </div>
          ) : (
            <div class="absolute inset-0 bg-gradient-to-r from-primary/90 to-primary/80"></div>
          )}
          <div class="relative z-10 text-center text-white px-4 max-w-2xl">
            <div class="bg-white/10 backdrop-blur-sm w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
              <ChefHat class="w-10 h-10" />
            </div>
            <h3 class="text-3xl font-bold mb-4">
              {homepageData?.specialFeatures?.seasonalMenus?.title || 'Seasonal Menus'}
            </h3>
            <p class="text-lg text-white/90">
              {homepageData?.specialFeatures?.seasonalMenus?.description || 'Fresh, locally-sourced ingredients prepared by our skilled chefs.'}
            </p>
          </div>
        </div>

        {/* Local Ales */}
        <div class="relative h-96 flex items-center justify-center overflow-hidden">
          {homepageData?.specialFeatures?.localAles?.image ? (
            <div class="absolute inset-0">
              <img 
                src={homepageData.specialFeatures.localAles.image.asset.url} 
                alt={homepageData.specialFeatures.localAles.image.alt}
                class="w-full h-full object-cover"
              />
              <div class="absolute inset-0 bg-black/50"></div>
            </div>
          ) : (
            <div class="absolute inset-0 bg-gradient-to-l from-secondary/90 to-secondary/80"></div>
          )}
          <div class="relative z-10 text-center text-white px-4 max-w-2xl">
            <div class="bg-white/10 backdrop-blur-sm w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
              <Beer class="w-10 h-10" />
            </div>
            <h3 class="text-3xl font-bold mb-4">
              {homepageData?.specialFeatures?.localAles?.title || 'Local Ales'}
            </h3>
            <p class="text-lg text-white/90">
              {homepageData?.specialFeatures?.localAles?.description || 'Carefully selected craft beers and traditional cask ales.'}
            </p>
          </div>
        </div>

        {/* Special Events */}
        <div class="relative h-96 flex items-center justify-center overflow-hidden">
          {homepageData?.specialFeatures?.specialEvents?.image ? (
            <div class="absolute inset-0">
              <img 
                src={homepageData.specialFeatures.specialEvents.image.asset.url} 
                alt={homepageData.specialFeatures.specialEvents.image.alt}
                class="w-full h-full object-cover"
              />
              <div class="absolute inset-0 bg-black/50"></div>
            </div>
          ) : (
            <div class="absolute inset-0 bg-gradient-to-r from-primary/90 to-primary/80"></div>
          )}
          <div class="relative z-10 text-center text-white px-4 max-w-2xl">
            <div class="bg-white/10 backdrop-blur-sm w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
              <Music class="w-10 h-10" />
            </div>
            <h3 class="text-3xl font-bold mb-4">
              {homepageData?.specialFeatures?.specialEvents?.title || 'Special Events'}
            </h3>
            <p class="text-lg text-white/90">
              {homepageData?.specialFeatures?.specialEvents?.description || 'Regular events, live music, and themed dining experiences.'}
            </p>
          </div>
        </div>
      </div>
    </section>

    {/* Customer Reviews Section */}
    <ReviewsSection reviews={featuredReviews.slice(0, 6)} />

    {/* Book a Table Section */}
    <section class="py-20 bg-gradient-to-b from-white to-gray-50">
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto text-center mb-12">
          <p class="text-secondary uppercase tracking-widest text-sm font-semibold mb-4">Reservations</p>
          <h2 class="text-4xl font-bold text-primary mb-6">Reserve Your Table</h2>
          <p class="text-lg text-gray-700">
            Choose your preferred pub and secure your table at one of our traditional British pubs.
          </p>
        </div>
        <div class="max-w-4xl mx-auto">
          <LiveResBookingWidget height="700px" client:load />
        </div>
      </div>
    </section>

    {/* Gift Cards Section */}
    <section class="py-20 bg-white">
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto text-center">
          <p class="text-secondary uppercase tracking-widest text-sm font-semibold mb-4">Gift Cards</p>
          <h2 class="text-4xl font-bold text-primary mb-6">Give the Gift of Great Times</h2>
          <div class="bg-secondary/10 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6">
            <Gift class="w-12 h-12 text-secondary" />
          </div>
          <p class="text-lg text-muted-foreground mb-8">
            WH Pubs gift cards are perfect for any occasion. Treat your loved ones to memorable moments at any of our traditional British pubs.
          </p>
          <a href="/gift-cards">
            <Button size="lg" variant="secondary">
              Buy Gift Cards
            </Button>
          </a>
        </div>
      </div>
    </section>



    {/* Newsletter Section */}
    <section class="bg-gradient-to-b from-primary to-primary/90 py-20 relative overflow-hidden">
      <div class="absolute inset-0 bg-[url('/images/pattern.svg')] opacity-5"></div>
      <div class="container mx-auto px-4 text-center relative z-10">
        <div class="max-w-2xl mx-auto">
          <Badge variant="secondary" className="mb-4">Newsletter</Badge>
          <h2 class="text-4xl font-bold text-secondary mb-4">Stay Updated</h2>
          <p class="text-secondary/90 mb-8 text-lg">Subscribe to our newsletter for the latest news, special offers, and exclusive events at WH Pubs.</p>
        <form 
          name="newsletter" 
          method="POST" 
          action="/thank-you"
          data-netlify="true" 
          data-netlify-honeypot="bot-field"
          class="max-w-md mx-auto flex gap-4"
        >
          <input type="hidden" name="form-name" value="newsletter" />
          <p class="hidden">
            <label>Don't fill this out if you're human: <input name="bot-field" /></label>
          </p>
          <label for="email-input" class="sr-only">Email address</label>
          <input
            id="email-input"
            type="email"
            name="email"
            placeholder="Enter your email"
            required
            aria-label="Email address for newsletter"
            class="flex-1 px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary bg-secondary/10 text-secondary placeholder:text-secondary/50 border border-secondary/20"
          />
          <Button type="submit" variant="secondary">Subscribe</Button>
        </form>
        </div>
      </div>
    </section>

  </main>
  
  <!-- Comprehensive anti-scroll for homepage with booking widget -->
  <script>
    (function() {
      // Immediately set scroll restoration to manual
      if ('scrollRestoration' in history) {
        history.scrollRestoration = 'manual';
      }
      
      // Force page to top
      window.scrollTo(0, 0);
      
      // Block scroll during initial load
      let scrollLocked = true;
      const lockScroll = () => {
        if (scrollLocked) {
          window.scrollTo(0, 0);
        }
      };
      
      // Add scroll lock
      window.addEventListener('scroll', lockScroll, { passive: true });
      
      // Setup on DOM ready
      document.addEventListener('DOMContentLoaded', () => {
        window.scrollTo(0, 0);
        
        // Handle all iframes
        const iframes = document.querySelectorAll('iframe');
        iframes.forEach(iframe => {
          iframe.setAttribute('tabindex', '-1');
          iframe.style.pointerEvents = 'none';
          
          // Monitor iframe load
          iframe.addEventListener('load', () => {
            window.scrollTo(0, 0);
            // Re-enable interaction after delay
            setTimeout(() => {
              iframe.style.pointerEvents = 'auto';
            }, 500);
          });
          
          // Block focus events
          iframe.addEventListener('focus', (e) => {
            e.preventDefault();
            iframe.blur();
          });
        });
      });
      
      // Final load handler
      window.addEventListener('load', () => {
        window.scrollTo(0, 0);
        
        // Unlock scrolling after everything loads
        setTimeout(() => {
          scrollLocked = false;
          // One final scroll to top
          window.scrollTo(0, 0);
        }, 1500);
      });
      
      // Additional check for late content
      document.addEventListener('readystatechange', () => {
        if (document.readyState === 'complete') {
          setTimeout(() => {
            if (window.scrollY > 0 && scrollLocked) {
              window.scrollTo(0, 0);
            }
          }, 100);
        }
      });
    })();
  </script>
</Layout>