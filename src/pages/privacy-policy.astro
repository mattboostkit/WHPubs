---
import Layout from '../layouts/Layout.astro';
import { getPrivacyPolicy } from '../lib/sanity';
import {PortableText} from '@portabletext/react';

// Get privacy policy for the main hub
const privacyPolicy = await getPrivacyPolicy();

if (!privacyPolicy) {
  return Astro.redirect('/404');
}

const lastUpdatedDate = privacyPolicy.lastUpdated 
  ? new Date(privacyPolicy.lastUpdated).toLocaleDateString('en-GB', {
      day: 'numeric',
      month: 'long',
      year: 'numeric'
    })
  : '';
---

<Layout title={privacyPolicy.title || 'Privacy Policy'}>
  <div class="bg-white py-16">
    <div class="container mx-auto px-4 max-w-4xl">
      <h1 class="text-4xl md:text-5xl font-serif text-center mb-8 text-primary">
        {privacyPolicy.title}
      </h1>
      
      {lastUpdatedDate && (
        <p class="text-center text-gray-600 mb-12">
          Last updated: {lastUpdatedDate}
        </p>
      )}
      
      <div class="prose prose-lg max-w-none privacy-content">
        {privacyPolicy.content && (
          <PortableText 
            value={privacyPolicy.content}
            components={{
              block: {
                h1: ({children}) => <h1 className="text-3xl font-serif mt-8 mb-4 text-primary">{children}</h1>,
                h2: ({children}) => <h2 className="text-2xl font-serif mt-6 mb-3 text-primary">{children}</h2>,
                h3: ({children}) => <h3 className="text-xl font-serif mt-4 mb-2 text-primary">{children}</h3>,
                normal: ({children}) => <p className="mb-4 text-gray-700 leading-relaxed">{children}</p>,
              },
              list: {
                bullet: ({children}) => <ul className="list-disc pl-6 mb-4 space-y-2">{children}</ul>,
                number: ({children}) => <ol className="list-decimal pl-6 mb-4 space-y-2">{children}</ol>,
              },
              listItem: {
                bullet: ({children}) => <li className="text-gray-700">{children}</li>,
                number: ({children}) => <li className="text-gray-700">{children}</li>,
              },
              marks: {
                strong: ({children}) => <strong className="font-semibold">{children}</strong>,
                em: ({children}) => <em className="italic">{children}</em>,
                link: ({value, children}) => (
                  <a href={value?.href} className="text-secondary hover:underline" target="_blank" rel="noopener noreferrer">
                    {children}
                  </a>
                ),
              },
            }}
          />
        )}
      </div>
    </div>
  </div>
</Layout>

<style>
  .privacy-content {
    @apply text-gray-700;
  }
  
  .privacy-content h1,
  .privacy-content h2,
  .privacy-content h3 {
    @apply text-primary;
  }
  
  .privacy-content a {
    @apply text-secondary hover:underline;
  }
</style>